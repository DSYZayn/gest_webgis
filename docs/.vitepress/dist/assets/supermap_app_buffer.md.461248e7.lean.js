import{l as t,N as g,T as v,D as h,F as b,B as S,S as w}from"./chunks/namespace.4bc4eca3.js";import{E as F}from"./chunks/index.02feb12e.js";import{E as _}from"./chunks/index.6d6f9088.js";import{E as f}from"./chunks/index.5b566563.js";import{d as B,h as N,j as P,o as C,c as A,H as o,w as y,a as m,l,F as T,k as D,C as L,Q as R}from"./chunks/framework.0ef9fb42.js";import"./chunks/dispatch.5e20a8fc.js";import"./chunks/value.823184c1.js";import"./chunks/isArray.61ae368f.js";import"./chunks/bisect.681d2435.js";import"./chunks/get.3dd6c794.js";import"./chunks/memoize.b774fe52.js";import"./chunks/index.aba9eb53.js";const M=D("div",{id:"buffer",class:"w-full h-full z-0"},null,-1),O="https://iserver.supermap.io/iserver/services/map-changchun/rest/maps/长春市区图",U=B({__name:"BufferMap",setup(d){let e,r=[];const p=N("团结路");P(()=>{const n=new t.Map("buffer",{crs:new g({bounds:new t.Bounds([48.4,-7668.25],[8958.85,-55.58]),origin:new t.Point(48.4,-55.58)}),center:[-3375,5105],maxZoom:18,zoom:6});e=n,new v(O).addTo(n)});function i(n){const s={FLAT:"FLAT",ROUND:"ROUND"},a=new h({dataset:"RoadLine2@Changchun",filterQueryParameter:new b({attributeFilter:"NAME='"+p.value+"'"}),bufferSetting:new S({endType:s.ROUND,leftDistance:{value:10},rightDistance:{value:10},semicircleLineSegment:10})}),c="https://iserver.supermap.io/iserver/services/spatialanalyst-changchun/restjsr/spatialanalyst";new w(c).bufferAnalysis(a).then(function(q){const E=q.result;if(console.log(E),E===void 0){f({title:"提示",type:"error",message:"缓冲区分析失败！"});return}f({title:"提示",type:"success",message:"缓冲区分析成功！"});const u=new t.GeoJSON(E.recordset.features,{style:{color:"red"}}).addTo(n);r.push(u),n.fitBounds(u.getBounds())})}return(n,s)=>(C(),A(T,null,[o(l(F),{type:"primary",onClick:s[0]||(s[0]=a=>i(l(e)))},{default:y(()=>[m("开始")]),_:1}),o(l(F),{type:"primary",onClick:s[1]||(s[1]=a=>l(r).forEach(c=>c.remove()))},{default:y(()=>[m("清除")]),_:1}),o(l(_),{placeholder:"路名",modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=a=>p.value=a),onChange:s[3]||(s[3]=a=>i(l(e))),style:{width:"10rem"}},null,8,["modelValue"]),M],64))}}),k=R(`<h1 id="缓冲区的实现" tabindex="-1">缓冲区的实现 <a class="header-anchor" href="#缓冲区的实现" aria-label="Permalink to &quot;缓冲区的实现&quot;">​</a></h1><details class="details custom-block"><summary>点击展开源码</summary><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setup</span><span style="color:#E1E4E8;"> &gt;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { onMounted, ref} </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vue&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> {Map, GeoJSON, Bounds, Point} </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;leaflet&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> {TiledMapLayer} </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@supermap/iclient-leaflet&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { DatasetBufferAnalystParameters, BufferSetting, FilterParameter } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">&#39;@supermap/iclient-common/iServer&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { SpatialAnalystService } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@supermap/iclient-leaflet/services&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { NonEarthCRS} </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@supermap/iclient-leaflet&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> {ElNotification, ElButton, ElInput} </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;element-plus&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">url</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://iserver.supermap.io/iserver/services/map-changchun/rest/maps/长春市区图&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> _map;</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> _bufferLayers </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">inputValue</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ref</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;团结路&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">onMounted</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">map</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Map</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;buffer&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        crs: </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NonEarthCRS</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">            bounds: </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Bounds</span><span style="color:#E1E4E8;">([</span><span style="color:#79B8FF;">48.4</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">7668.25</span><span style="color:#E1E4E8;">], [</span><span style="color:#79B8FF;">8958.85</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">55.58</span><span style="color:#E1E4E8;">]),</span></span>
<span class="line"><span style="color:#E1E4E8;">            origin: </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Point</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">48.4</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">55.58</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        }),</span></span>
<span class="line"><span style="color:#E1E4E8;">        center: [</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3375</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">5105</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">        maxZoom: </span><span style="color:#79B8FF;">18</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        zoom: </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        attributionControl:</span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">    _map </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> map;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">layer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TiledMapLayer</span><span style="color:#E1E4E8;">(url);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">layer.</span><span style="color:#B392F0;">addTo</span><span style="color:#E1E4E8;">(map);</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">startBuffer</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">map</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#6A737D;">// 设置缓冲区分析参数</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">BufferEndType</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/** 平头缓冲。 */</span></span>
<span class="line"><span style="color:#E1E4E8;">  FLAT: </span><span style="color:#9ECBFF;">&quot;FLAT&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/** 圆头缓冲。 */</span></span>
<span class="line"><span style="color:#E1E4E8;">  ROUND: </span><span style="color:#9ECBFF;">&quot;ROUND&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dsBufferAnalystParams</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DatasetBufferAnalystParameters</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 用来做缓冲区分析的数据源中数据集名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    dataset: </span><span style="color:#9ECBFF;">&quot;RoadLine2@Changchun&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 设置数据集中集合对象的过滤条件</span></span>
<span class="line"><span style="color:#E1E4E8;">    filterQueryParameter: </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">FilterParameter</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 属性过滤条件</span></span>
<span class="line"><span style="color:#E1E4E8;">        attributeFilter: </span><span style="color:#9ECBFF;">&quot;NAME=&#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> inputValue.value </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&#39;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 缓冲区分析通用参数设置</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    bufferSetting: </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BufferSetting</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 缓冲区端点枚举值，包含FLAT和ROUND</span></span>
<span class="line"><span style="color:#E1E4E8;">        endType: BufferEndType.</span><span style="color:#79B8FF;">ROUND</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 左侧缓冲距离</span></span>
<span class="line"><span style="color:#E1E4E8;">        leftDistance: {value: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 右侧缓冲距离</span></span>
<span class="line"><span style="color:#E1E4E8;">        rightDistance: {value: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 圆头缓冲圆弧处线段的个数</span></span>
<span class="line"><span style="color:#E1E4E8;">        semicircleLineSegment: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">serviceUrl</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://iserver.supermap.io/iserver/services/spatialanalyst-changchun/restjsr/spatialanalyst&quot;</span></span>
<span class="line"><span style="color:#6A737D;">// 创建缓冲区分析服务</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">bufferServiceByDatasets</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SpatialAnalystService</span><span style="color:#E1E4E8;">(serviceUrl);</span></span>
<span class="line"><span style="color:#6A737D;">// 向服务端发送服务请求，并获取返回的结果</span></span>
<span class="line"><span style="color:#E1E4E8;">bufferServiceByDatasets.</span><span style="color:#B392F0;">bufferAnalysis</span><span style="color:#E1E4E8;">(dsBufferAnalystParams).</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">serviceResult</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 获取服务端返回的数据</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">result</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> serviceResult.result;</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(result);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ( result </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">undefined</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ElNotification</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">            title:</span><span style="color:#9ECBFF;">&quot;提示&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            type:</span><span style="color:#9ECBFF;">&quot;error&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            message:</span><span style="color:#9ECBFF;">&quot;缓冲区分析失败！&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ElNotification</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">        title:</span><span style="color:#9ECBFF;">&quot;提示&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        type:</span><span style="color:#9ECBFF;">&quot;success&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        message:</span><span style="color:#9ECBFF;">&quot;缓冲区分析成功！&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">multiPolygon</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">GeoJSON</span><span style="color:#E1E4E8;">(result.recordset.features, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        style:{</span></span>
<span class="line"><span style="color:#E1E4E8;">            color:</span><span style="color:#9ECBFF;">&quot;red&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }).</span><span style="color:#B392F0;">addTo</span><span style="color:#E1E4E8;">(map);</span></span>
<span class="line"><span style="color:#E1E4E8;">    _bufferLayers.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(multiPolygon);</span></span>
<span class="line"><span style="color:#E1E4E8;">    map.</span><span style="color:#B392F0;">fitBounds</span><span style="color:#E1E4E8;">(multiPolygon.</span><span style="color:#B392F0;">getBounds</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">el-button</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;primary&quot;</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">@click</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;startBuffer(_map)&quot;</span><span style="color:#E1E4E8;">&gt;开始&lt;/</span><span style="color:#85E89D;">el-button</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">el-button</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;primary&quot;</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">@click</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;_bufferLayers.forEach(layer=&gt;layer.remove())&quot;</span><span style="color:#E1E4E8;">&gt;清除&lt;/</span><span style="color:#85E89D;">el-button</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">el-input</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">placeholder</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;路名&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">v-model</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;inputValue&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">@change</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;startBuffer(_map)&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">style</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;width: 10rem;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &gt;&lt;/</span><span style="color:#85E89D;">el-input</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;buffer&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;w-full h-full z-0&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">style</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">scoped</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">style</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setup</span><span style="color:#24292E;"> &gt;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { onMounted, ref} </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vue&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> {Map, GeoJSON, Bounds, Point} </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;leaflet&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> {TiledMapLayer} </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@supermap/iclient-leaflet&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { DatasetBufferAnalystParameters, BufferSetting, FilterParameter } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;">   </span><span style="color:#032F62;">&#39;@supermap/iclient-common/iServer&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { SpatialAnalystService } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@supermap/iclient-leaflet/services&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { NonEarthCRS} </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@supermap/iclient-leaflet&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> {ElNotification, ElButton, ElInput} </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;element-plus&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">url</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://iserver.supermap.io/iserver/services/map-changchun/rest/maps/长春市区图&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> _map;</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> _bufferLayers </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">inputValue</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ref</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;团结路&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6F42C1;">onMounted</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">map</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Map</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;buffer&#39;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">        crs: </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NonEarthCRS</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">            bounds: </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Bounds</span><span style="color:#24292E;">([</span><span style="color:#005CC5;">48.4</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">7668.25</span><span style="color:#24292E;">], [</span><span style="color:#005CC5;">8958.85</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">55.58</span><span style="color:#24292E;">]),</span></span>
<span class="line"><span style="color:#24292E;">            origin: </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Point</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">48.4</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">55.58</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        }),</span></span>
<span class="line"><span style="color:#24292E;">        center: [</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3375</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">5105</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">        maxZoom: </span><span style="color:#005CC5;">18</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        zoom: </span><span style="color:#005CC5;">6</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        attributionControl:</span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    });</span></span>
<span class="line"><span style="color:#24292E;">    _map </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> map;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">layer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TiledMapLayer</span><span style="color:#24292E;">(url);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">layer.</span><span style="color:#6F42C1;">addTo</span><span style="color:#24292E;">(map);</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">startBuffer</span><span style="color:#24292E;">(</span><span style="color:#E36209;">map</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#6A737D;">// 设置缓冲区分析参数</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">BufferEndType</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/** 平头缓冲。 */</span></span>
<span class="line"><span style="color:#24292E;">  FLAT: </span><span style="color:#032F62;">&quot;FLAT&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/** 圆头缓冲。 */</span></span>
<span class="line"><span style="color:#24292E;">  ROUND: </span><span style="color:#032F62;">&quot;ROUND&quot;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dsBufferAnalystParams</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DatasetBufferAnalystParameters</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 用来做缓冲区分析的数据源中数据集名称</span></span>
<span class="line"><span style="color:#24292E;">    dataset: </span><span style="color:#032F62;">&quot;RoadLine2@Changchun&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 设置数据集中集合对象的过滤条件</span></span>
<span class="line"><span style="color:#24292E;">    filterQueryParameter: </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">FilterParameter</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 属性过滤条件</span></span>
<span class="line"><span style="color:#24292E;">        attributeFilter: </span><span style="color:#032F62;">&quot;NAME=&#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> inputValue.value </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&#39;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    }),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 缓冲区分析通用参数设置</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    bufferSetting: </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BufferSetting</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 缓冲区端点枚举值，包含FLAT和ROUND</span></span>
<span class="line"><span style="color:#24292E;">        endType: BufferEndType.</span><span style="color:#005CC5;">ROUND</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 左侧缓冲距离</span></span>
<span class="line"><span style="color:#24292E;">        leftDistance: {value: </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 右侧缓冲距离</span></span>
<span class="line"><span style="color:#24292E;">        rightDistance: {value: </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 圆头缓冲圆弧处线段的个数</span></span>
<span class="line"><span style="color:#24292E;">        semicircleLineSegment: </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">serviceUrl</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://iserver.supermap.io/iserver/services/spatialanalyst-changchun/restjsr/spatialanalyst&quot;</span></span>
<span class="line"><span style="color:#6A737D;">// 创建缓冲区分析服务</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">bufferServiceByDatasets</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SpatialAnalystService</span><span style="color:#24292E;">(serviceUrl);</span></span>
<span class="line"><span style="color:#6A737D;">// 向服务端发送服务请求，并获取返回的结果</span></span>
<span class="line"><span style="color:#24292E;">bufferServiceByDatasets.</span><span style="color:#6F42C1;">bufferAnalysis</span><span style="color:#24292E;">(dsBufferAnalystParams).</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">serviceResult</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 获取服务端返回的数据</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">result</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> serviceResult.result;</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(result);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> ( result </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">undefined</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ElNotification</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">            title:</span><span style="color:#032F62;">&quot;提示&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            type:</span><span style="color:#032F62;">&quot;error&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            message:</span><span style="color:#032F62;">&quot;缓冲区分析失败！&quot;</span></span>
<span class="line"><span style="color:#24292E;">        });</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ElNotification</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">        title:</span><span style="color:#032F62;">&quot;提示&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        type:</span><span style="color:#032F62;">&quot;success&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        message:</span><span style="color:#032F62;">&quot;缓冲区分析成功！&quot;</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">multiPolygon</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GeoJSON</span><span style="color:#24292E;">(result.recordset.features, {</span></span>
<span class="line"><span style="color:#24292E;">        style:{</span></span>
<span class="line"><span style="color:#24292E;">            color:</span><span style="color:#032F62;">&quot;red&quot;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }).</span><span style="color:#6F42C1;">addTo</span><span style="color:#24292E;">(map);</span></span>
<span class="line"><span style="color:#24292E;">    _bufferLayers.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(multiPolygon);</span></span>
<span class="line"><span style="color:#24292E;">    map.</span><span style="color:#6F42C1;">fitBounds</span><span style="color:#24292E;">(multiPolygon.</span><span style="color:#6F42C1;">getBounds</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">el-button</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;primary&quot;</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">@click</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;startBuffer(_map)&quot;</span><span style="color:#24292E;">&gt;开始&lt;/</span><span style="color:#22863A;">el-button</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">el-button</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;primary&quot;</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">@click</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;_bufferLayers.forEach(layer=&gt;layer.remove())&quot;</span><span style="color:#24292E;">&gt;清除&lt;/</span><span style="color:#22863A;">el-button</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">el-input</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">placeholder</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;路名&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">v-model</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;inputValue&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">@change</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;startBuffer(_map)&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">style</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;width: 10rem;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    &gt;&lt;/</span><span style="color:#22863A;">el-input</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;buffer&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;w-full h-full z-0&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">style</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">scoped</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">style</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></details>`,2),V={class:"w-full h-96"},ss=JSON.parse('{"title":"缓冲区的实现","description":"","frontmatter":{},"headers":[],"relativePath":"supermap/app/buffer.md","filePath":"supermap/app/buffer.md"}'),x={name:"supermap/app/buffer.md"},ns=B({...x,setup(d){return(e,r)=>{const p=L("ClientOnly");return C(),A("div",null,[k,o(p,null,{default:y(()=>[D("div",V,[o(U)])]),_:1})])}}});export{ss as __pageData,ns as default};
